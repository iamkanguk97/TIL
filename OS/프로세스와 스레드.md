# 프로세스와 스레드

> `프로세스(Process)`: 운영체제로부터 자원을 할당받은 `작업의 단위`<br/> `스레드(Thread)`: 프로세스가 할당받은 자원을 이용하는 `실행 흐름의 단위`

## 프로그램과 프로세스

### 정적 프로그램 (Static Program)

-   윈도우의 exe 파일, Mac의 dmg 파일과 같은 **컴퓨터에서 실행할 수 있는 파일**
-   프로그램은 쉽게 말해서 **코드 덩어리**라고 생각하면 된다.

### 프로세스 (Process)

-   프로세스는 프로그램을 실행시켜서 정적인 프로그램이 동적으로 변해서 프로그램이 돌아가고 있는 상태를 말한다. (컴퓨터에서 작업중인 프로그램)
-   모든 프로그램은 운영체제가 실행되기 위한 메모리 공간을 할당해줘야 실행될 수 있다. 그래서 프로그램을 실행하는 순간 파일은 컴퓨터의 메모리에 올라가게 되고 운영체제로부터 시스템 자원(CPU)를 할당받아서 프로그램 코드를 실행시켜 우리가 서비스를 이용할 수 있게 되는 것이다.

| 프로그램                                                         | 프로세스                                                              |
| ---------------------------------------------------------------- | --------------------------------------------------------------------- |
| 어떤 작업을 하기 위해 실행할 수 있는 파일                        | 실행되어 작업중인 컴퓨터 프로그램                                     |
| 파일이 저장 장치에 있지만 메모리에는 올라가있지 않은 정적인 상태 | 메모리에 적재되고 CPU 자원을 할당받아서 프로그램이 실행되고 있는 상태 |
| 코드 덩어리                                                      | 코드 덩어리를 실행한 것                                               |

## 스레드 (Thread)

### 프로세스의 한계

-   과거에는 프로그램을 실행할 때 프로세스 1개만을 사용해서 이용했다. 그런데 기술이 발전되면서 프로그램이 복잡해지고 프로세스 작업 하나만을 사용해서 프로그램을 실행하는데는 한계가 있다.
-   스레드는 이런 프로세스 특성의 한계를 해결하기 위해 만들어졌다.

### 스레드의 개념

> **하나의 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름의 단위**

크롬 브라우저가 실행되면 프로세스 1개가 생성된다. 그런데 우리는 브라우저에서 파일을 다운 받으면서 음악 감상도 가능하고 게임도 가능하다.
이건 하나의 프로세스 안에서 여러가지 작업들 흐름이 동시에 진행되기 때문에 가능한 것이다. 그런 작업 흐름들을 스레드라고 부르고 여러개가 있으면 `멀티 스레드`라고 부른다.

당연하게 스레드 수가 많으면 많을수록 프로그램 속도도 동시에 하는 작업들이 많아져서 성능이 올라갈 수 밖에 없다.

-   하나의 프로그램은 하나 이상의 프로세스를 가지고 있다.
-   하나의 프로세스는 반드시 하나 이상의 스레드를 갖는다.
-   프로세스를 생성하면 기본적으로 하나의 main 스레드가 생성되는 것이고, 이후 2-3개의 스레드는 개발자가 직접 프로그래밍을 통해 할당해야 한다.

---

## 프로세스와 스레드의 메모리

### 프로세스의 자원 구조

> **프로그램이 실행되어 프로세스가 만들어지면 4가지의 메모리 영역으로 구성되어 할당받는다.**

<img src="https://github.com/user-attachments/assets/b42bb393-2e5e-4797-be2d-bbfac8e22614" />

-   `코드 영역(Code / Text)`: 프로그래머가 작성한 프로그램 함수들의 코드가 CPU가 해석 가능한 기계어 형태로 저장되어 있는 곳
-   `데이터 영역(Data)`: 코드가 실행되면서 사용하는 전역 변수나 각종 데이터들이 모여있다.
    -   `.data`: 전역 변수 또는 static 변수 등 프로그램이 사용하는 데이터를 저장
    -   `.BSS`: 초기값 없는 전역 변수, static 변수가 저장
    -   `.rodata`: const 같은 상수 키워드 선언된 변수나 문자열 상수가 저장
-   `스택 영역(Stack)`: 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간. 함수의 호출과 함께 할당되며 함수의 호출이 완료되면 소멸한다. Stack 영역을 초과하면 Stack Overflow 에러가 발생한다.
-   `힙 영역(Heap)`: 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간. 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다.

**코드영역과 데이터영역은 선언할 때 그 크기가 결정되는 정적 영역이지만, 스택영역과 힙영역은 프로세스가 실행되는 동안 동적 영역이다.**

### 스레드의 자원 공유

<img src="https://github.com/user-attachments/assets/b6818d97-2e35-4a95-8ccb-0d7f635e3bcc" />

-   스레드: 프로세스가 할당받은 자원을 이용하는 실행의 단위 -> 스레드가 여러개면 우리가 파일을 다운받으면서 웹 서핑이 가능함!
-   이는 스레드끼리 프로세스의 자원을 공유하면서 프로세스 실행 흐름의 일부가 되기 때문에 동시 작업이 가능한 것이다.
-   위의 사진처럼 스레드는 stack만 할당받아서 복사하고 code, data, heap 영역은 프로세스 내의 다른 스레드들과 공유된다.
-   그래서 각 스레드는 별도의 stack을 가지고 있지만 heap 메모리는 고유하기 때문에 서로 다른 스레드에서 가져와서 읽고 쓸 수 있게 된다.

참고로 stack은 함수 호출 시 전달되는 인자, 되돌아갈 주소값, 함수 내에서 선언하는 변수 등을 저장하는 메모리 공간이기 때문에 독립적인 스택을 가졌다는 것은 독립적인 함수 호출이 가능하다는 것이다. 그리고 독립적인 함수 호출이 가능하다는 것은 독립적인 실행 흐름이 추가된다는 말이다.

즉, stack을 가지면서 스레드는 독립적인 실행 흐름을 가질 수 있게 되는 것이다. 반면에 프로세스는 기본적으로 프로세스끼리 다른 프로세스의 메모리에 직접 접근할 수는 없다.

### 프로세스의 자원 공유

> **기본적으로 각 프로세스는 메모리에 별도의 주소 공간에서 실행되기 때문에 하나의 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.**

하지만 실제로는 특별한 방법을 통해서 프로세스가 다른 프로세스의 정보에 접근하는 것이 가능하다. 대표적으로는 2가지의 방법이 있다.

-   `IPC(Inter-Process Communication)`
-   `LPC(Local Inter-Process Communication)`
-   별도로 공유 메모리를 만들어서 정보를 주고받도록 설정

하지만 프로세스 자원 공유는 단순히 CPU 레지스터 교체뿐만이 아니라 RAM과 CPU 사이의 캐시 메모리까지 초기화되기 때문에 자원 부담이 크다는 단점이 있다. 그래서 다중 작업이 필요한 경우 스레드를 이용하는 것이 훨씬 효율적이다. 현대 컴퓨터의 운영체제에서는 다중 프로세싱을 지원하고는 있지만 다중 스레딩을 기본으로 한다.

## 프로세스와 스레드의 동시 실행 원리

### 멀티 코어와 스레드

-   CPU 1개는 여러개의 코어를 가질 수 있다. 코어는 CPU 코어 유닛이다.
-   다시 말해서, 명령어를 메모리에서 뽑아서 해석하고 실행하는 반도체 유닛이 4개 있는 것이라고 생각하자.

---

## 참고자료

-   [완전히 정복하는 프로세스 vs 스레드 개념](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4)
