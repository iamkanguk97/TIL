# Basic 인증과 Bearer 인증에 대해서

> **프로필 사진 AI합성을 위해서 AI서버와 API서버의 통신이 필요한데 우리는 Basic 인증을 사용하기로 결정했다. 그런데 항상 생각없이 Bearer만 사용했던 것 같아서 Basic 인증이 무엇인지 궁금해져서 TIL을 작성하게 되었다.**

## HTTP 통신 방법

HTTP 통신은 요청과 응답으로 HTML 문서 및 웹 리소스를 불러온다. 보통 클라이언트(웹브라우저)가 서버에 요청을 보내면 서버는 요청한 리소스를 보내준다.
그러면 왜 HTTP 통신에는 인증이 필요할까? 예를 들어서 블로그 포스트를 하나 작성했다고 가정한다면 그 블로그 포스트는 나만 수정하고 삭제할 수 있어야 한다.

즉, 블로그 포스트나 이메일과 같이 보호된 서버 리소스를 접근하는 클라이언트의 인증 정보(Credentials)가 필요하다.

```text
Authorization: <type> <credentials>
```

-   정상적인 인증 정보면 200, 인증 헤더를 누락하면 401, 권한이 없는 접근이라면 403 에러코드를 반환한다.

## Basic 인증

-   가장 기본적인 인증방식이다. 인증 정보로 사용자ID와 비밀번호를 사용한다.
-   BASE64로 인코딩한 `사용자ID:비밀번호` 문자열을 `Basic`과 함께 인증 헤더에 입력한다.
-   참고로 BASE64는 쉽게 복호화할 수 있기 때문에 HTTPS, SSL/TLS로 통신해야 안전하다.

```text
Authorization: Basic base64({USERNAME}:{PASSWORD})
```

### Basic 인증의 Pros and Cons

-   가장 큰 장점은 `간단함`이다. 그렇지만 Basic 인증 방식은 서버에 사용자 목록을 저장한다(?)
-   그래서 요청한 리소스가 많거나 사용자가 많으면 목록에서 권한을 확인하는 시간이 걸어진다.
-   그리고 서버에 저장할 수 있는 데이터는 한정되어 있어서 사용자가 많거나 사용자 변화가 잦은 서비스가 Basic 인증을 사용하게 되면 서버에 부담이 커지게 된다.
-   그리고 Basic 인증 방식으로는 사용자 권한을 정교하게 제어할 수 없다. 사용자가 꼭 필요로 하는 리소스에만 권한을 주는 것이 일반적이고 좋은데 Basic 인증 방식으로 세세하게 사용자의 권한을 설정하려면 추가적인 구현이 필요하다.

## Bearer 인증

-   OAuth 2.0 프레임워크에서 사용하는 토큰 인증 방식
-   "이 토큰의 소유자에게 권한을 부여해줘" 라는 의미로 이름을 붙였다고 한다 (Bearer: 소유자)

```text
Authorization: Bearer <token>
```

### OAuth 2.0 프레임워크

-   회원가입을 하지 않아도 구글과 같은 소셜 계정으로 바로 이용할 수 있는 서비스가 많다. 이것은 구글에서 내 데이터의 일부를 제 3자의 서비스와 공유하는 것이다.
-   이렇게 다양한 서비스 또는 서버 사이에 안전하게 데이터를 전송하기 위해 OAuth 프레임워크가 나왔다.
-   **OAuth 프레임워크는 제 3자의 클라이언트에게 보호된 리소스를 제한적으로 접근하게 해주는 프레임워크라고 생각하자.**

<img src="https://velog.velcdn.com/images/tosspayments/post/00e43ffd-de9b-402e-a6ff-db0c78ddd4d7/image.png" />

-   OAuth 프레임워크에는 크게 `리소스 소유자`, `클라이언트`, `인증 서버`, `리소스 서버`가 있다.
    -   리소스 소유자: 사용자(?)
    -   클라이언트: 사용자의 정보를 접근하는 제3자의 서비스
    -   인증 서버: 클라이언트의 접근을 관리하는 서버
    -   리소스 서버: 리소스 소유자의 데이터를 관리하는 서버
-   리소스 소유자의 동의가 확인되면 인증 서버는 클라이언트에게 액세스 토큰을 발급해준다.
-   클라이언트는 액세스 토큰을 사용해서 리소스 서버에 보호된 데이터를 불러온다.

### Bearer 토큰

-   OAuth 프레임워크에서 액세스 토큰으로 사용하는 토큰의 유형
-   Bearer 토큰은 불투명한(Opaque)(?) 문자열이다. 토큰의 형태는 인증 서버에서 정의하기 나름인데 `16진수의 문자열`을 사용하기도 하고 `JSON WEB TOKEN(JWT)`을 사용하기도 한다.
-   중요한 점은 Bearer 토큰은 클라이언트가 해석할 수 없는 형태여야 하고, 사용자의 정보를 전달하면 안된다.
-   단, 서버에서 클라이언트의 권한을 확인할 수 있는 메타데이터가 토큰에 인코딩되어 있어야 한다. 충분히 복잡한 알고리즘을 사용해서 발급해야 한다.

### Bearer 인증의 Pros and Cons

-   안전하고 확장이 쉽다. Bearer 토큰은 복호화가 어렵고 OAuth는 프레임워크의 인증 및 리소스 서버는 SSL/TLS를 필수로 사용한다.
-   서버에서 토큰의 리소스 접근 권한을 쉽게 철회할 수도 있고 토큰의 유효기간을 설정할 수 있어서 안전하게 리소스를 보호할 수 있다.
-   그리고 리소스 접근을 정교하게 설정할 수 있다.
-   Bearer 토큰 자체가 메타데이터를 가지고 있어서 서버는 토큰을 발급만 하고 보관할 필요가 없다. 사용자가 많아도 토큰을 검증하는 과정은 같은 시간이 소요된다. 게다가 여러 서비스 및 서버 간에 토큰을 공유할 수 있어서 사용자에게 편리한 경험을 제공한다.

-   하지만 보안 측면에서 문제가 있다. 만약 Bearer 토큰이 노출되면 다른 서비스도 토큰으로 바로 리소스에 접근할 수 있다.
-   하지만 OAuth 프레임워크에 정의된 보안 장치를 잘 구축하면 문제가 없고 노출이 발견되면 해당 토큰의 권한을 철회할 수 있다. 단, 노출된 것을 발견하는게 쉽지 않을뿐....

### 표로 정리하는 Basic 인증방식과 Bearer 인증방식의 차이점

> MFA: Multi-Factor Authentication (다중 인증)

|             |                                       보안                                        |                                    확장성                                    |                                   복잡성                                    |
| ----------- | :-------------------------------------------------------------------------------: | :--------------------------------------------------------------------------: | :-------------------------------------------------------------------------: |
| Basic 인증  |  쉽게 복호화할 수 있는 base64를 사용하고 노출된 인증 정보를 철회할 방법이 없다.   |    사용자 서버를 서버에 저장하기 때문에 사용자 많을수록 서버에 부담된다.     |           간단한 인증방식이지만 정교하게 권한을 제어하기 어렵다.            |
| Bearer 인증 | 충분히 복잡한 알고리즘으로 토큰을 발급하고 토큰이 노출되면 권한을 철회할 수 있음. | Bearer 토큰이 메타데이터를 담고 있어서 사용자가 많아도 서버에 부담되지 않음. | 정교하게 권한을 제어할 수 있고 유효기간, MFA 등 추가 장치도 연동할 수 있음. |

## 참고자료

-   [Basic 인증과 Bearer 인증의 모든 것](https://docs.tosspayments.com/blog/everything-about-basic-bearer-auth)
-   [HTTP 인증, MDN](https://developer.mozilla.org/ko/docs/Web/HTTP/Authentication)
-   [[간단정리] HTTP Request/Response 구조](https://hahahoho5915.tistory.com/62#HyperText%25--Transfer%25--Protocol)
